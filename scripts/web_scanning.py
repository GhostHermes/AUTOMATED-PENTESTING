import subprocess
import os
from dotenv import load_dotenv
from openai import OpenAI

# Load the environment variables from the .env file
load_dotenv()

# Now you can access the API key using os.getenv
openai = OpenAI(os.getenv('openai_api_key'))

class WebScanner:

    def __init__(self, target, output_file):
        self.target = target
        self.output_file = output_file

    def run(self):
        raise NotImplementedError

    def process_output(self, output):
        # Implement common output processing here if needed
        pass

    def check_with_gpt(self, prompt):
        response = openai.Completion.create(
          engine="text-davinci-003.5-turbo",
          prompt=prompt,
          temperature=0.5,
          max_tokens=100
        )
        return response.choices[0].text.strip()

class DirectoryDiscoveryScanner(WebScanner):

    def run(self):
        print("Running directory discovery on " + self.target)
        decision_prompt = f"Should I run a directory discovery scan on {self.target}?"
        decision = self.check_with_gpt(decision_prompt)
        if decision.lower() == 'yes':
            subprocess.call(['python', 'path_to_DirSearch/dirsearch.py', '-u', self.target, '-o', self.output_file])

class JsDiscoveryScanner(WebScanner):

    def run(self):
        print("Running JS discovery on " + self.target)
        decision_prompt = f"Should I run a JS discovery scan on {self.target}?"
        decision = self.check_with_gpt(decision_prompt)
        if decision.lower() == 'yes':
            subprocess.call(['python', 'path_to_tool/tool.py', '-i', self.target, '-o', self.output_file])

class UrlDiscoveryScanner(WebScanner):

    def run(self):
        print("Running URL discovery on " + self.target)
        decision_prompt = f"Should I run a URL discovery scan on {self.target}?"
        decision = self.check_with_gpt(decision_prompt)
        if decision.lower() == 'yes':
            subprocess.call(['python', 'path_to_getallurls/getallurls.py', '-d', self.target, '-o', self.output_file])
