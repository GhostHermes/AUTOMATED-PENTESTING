import os
from dotenv import load_dotenv
from openai import OpenAI
from scripts.network_scanning import NetworkScanner
from scripts.web_scanning import WebScanner
from scripts.vulnerability_scanning import VulnerabilityScanner

def main():
    # Load environment variables from .env file
    load_dotenv()

    # Get OpenAI key from environment variables
    openai_key = os.getenv("OPENAI_KEY")

    # Initialize OpenAI client
    openai = OpenAI(openai_key)

    # Get target domain from user
    target_domain = input("Enter the target domain: ")

    # Define output files
    network_output_file = "network_output.txt"
    web_output_file = "web_output.txt"
    vulnerability_output_file = "vulnerability_output.txt"

    # Initialize scanners
    network_scanner = NetworkScanner(openai)
    web_scanner = WebScanner(openai)
    vulnerability_scanner = VulnerabilityScanner(openai)

    # Network Scanning
    print("Starting subdomain discovery...")
    network_scanner.subdomain_discovery(target_domain, network_output_file)

    # Web Scanning
    print("Starting web scanning...")
    web_scanner.scan(target_domain, web_output_file)

    # Vulnerability Scanning
    print("Starting vulnerability scanning...")
    vulnerability_scanner.scan(target_domain, vulnerability_output_file)

if __name__ == "__main__":
    main()
